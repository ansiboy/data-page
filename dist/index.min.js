/*! maishu-data-page v1.1.0 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("maishu-ui-toolkit"),require("react-dom"),require("maishu-wuzhui-helper"),require("maishu-dilu")):"function"==typeof define&&define.amd?define(["react","maishu-ui-toolkit","react-dom","maishu-wuzhui-helper","maishu-dilu"],t):"object"==typeof exports?exports["chitu-admin"]=t(require("react"),require("maishu-ui-toolkit"),require("react-dom"),require("maishu-wuzhui-helper"),require("maishu-dilu")):e["chitu-admin"]=t(e.react,e["maishu-ui-toolkit"],e["react-dom"],e["maishu-wuzhui-helper"],e["maishu-dilu"])}(window,(function(e,t,n,i,r){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.classNames=void 0,t.classNames={tableWrapper:"table-wrapper"};if(!document.getElementById("maishu-data-page-style")&&null!=document.head){let e=document.createElement("style");e.type="text/css",e.id="maishu-data-page-style",document.head.appendChild(e),e.innerHTML=`\n.${t.classNames.tableWrapper} {\n    overflow-y: scroll;\n    overflow-x: hidden;\n    border: solid 1px #cccccc;\n    border-top: none;\n}\n.${t.classNames.tableWrapper} table tbody tr td:first-child {\n    border-left-color: white;\n}\n.${t.classNames.tableWrapper} table tbody tr td:last-child {\n    border-right-color: white;\n}\n.${t.classNames.tableWrapper} .table-bordered {\n    border: none;\n}\n`}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.strings=void 0,t.strings={back:"返回",cancel:"取消",ok:"确定",modify:"修改",add:"添加"}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.InputControl=void 0;const l=a(n(0));class s extends l.Component{constructor(e){super(e)}}t.InputControl=s,s.defaultProps={validation:{rules:[]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataListPage=void 0,n(1);var i=n(7);Object.defineProperty(t,"DataListPage",{enumerable:!0,get:function(){return i.DataListPage}})},function(e,t,n){"use strict";var i,r,a,l=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&l(t,e,n);return s(t,e),t},c=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function l(e){try{o(i.next(e))}catch(e){a(e)}}function s(e){try{o(i.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}o((i=i.apply(e,t||[])).next())}))},u=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},d=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.DataListPage=void 0;const h=n(8),m=n(9),f=o(n(0)),p=n(10),b=o(n(4)),v=n(5),y=n(3),g=n(1);class E extends v.InputControl{constructor(e){super(e),this.state={}}get value(){return null!=this.control?this.control.value:this._value}set value(e){null!=this.control?this.control.value=e:this._value=e}render(){return console.assert(null!=this.state),f.createElement("span",{ref:e=>{null==this.control&&null!=e&&(this.control=this.props.boundField.createControl(),this.control.element.setAttribute("name",this.props.dataField),this.control.value=this._value,this.props.emptyText&&(this.control.element.placeholder=this.props.emptyText),this.control.element.onchange=()=>{this._value=this.control.value},e.appendChild(this.control.element))}})}}class w extends h.BasePage{constructor(e){if(super(e),i.set(this,void 0),r.set(this,void 0),a.set(this,void 0),this.CommandColumnWidth=140,this.ScrollBarWidth=18,this.pageSize=15,this.headerFixed=!1,this.showCommandColumn){let e=this;u(this,a,new m.CustomField({headerText:"操作",headerStyle:{textAlign:"center",width:this.CommandColumnWidth+"px"},itemStyle:{textAlign:"center",width:this.CommandColumnWidth+"px"},createItemCell(t,n){let i=new m.GridViewCell(n);return b.render(f.createElement(f.Fragment,null,e.leftCommands(t),e.editButton(t),e.deleteButton(t),e.rightCommands(t)),i.element),i}}))}window.addEventListener("resize",()=>{let e,t=window.innerHeight-160,n=window.innerWidth-80,i=document.getElementsByClassName("first")[0],r=document.getElementsByClassName("second")[0];i&&(n-=i.offsetWidth),r&&(n-=r.offsetWidth),null!=this.state&&(e=this.state.tableSize),null!=e&&e.height==t&&e.width==n||this.setState({tableSize:{width:n,height:t}})})}get showCommandColumn(){return!0}calcTableSize(){let e=window.innerHeight-160,t=window.innerWidth-40,n=document.getElementsByClassName("first")[0],i=document.getElementsByClassName("second")[0];return n&&(t-=n.offsetWidth),i&&(t-=i.offsetWidth),{width:t,height:e}}componentDidMount(){this.columns=this.columns||[],this.gridView=m.createGridView({element:d(this,i),dataSource:this.dataSource,columns:d(this,a)?[...this.columns,d(this,a)]:this.columns,pageSize:this.pageSize,translate:this.translate,showHeader:1!=this.headerFixed})}renderEditor(){return f.createElement(f.Fragment,null,this.columns.filter(e=>e instanceof m.BoundField&&1!=e.readOnly).map((e,t)=>f.createElement("div",{key:t,className:"form-group clearfix input-control"},f.createElement("label",null,e.headerText),f.createElement(E,{boundField:e,dataField:e.dataField,validation:e.validation,emptyText:e.emptyText}))))}renderToolbarRight(){let e=this.renderEditor();if(null==e)return[];u(this,r,p.createItemDialog(this.dataSource,this.itemName||"",e));let t=this.addButton(),n=this.searchControl(),i=[];return n&&i.push(n),t&&i.push(t),i}addButton(){return this.dataSource.canInsert?f.createElement("button",{key:"btnAdd",className:"btn btn-primary btn-sm",onClick:()=>d(this,r).show({})},f.createElement("i",{className:"fa fa-plus"}),f.createElement("span",null,"添加")):null}editButton(e){if(!this.dataSource.canUpdate)return null;let t=(this.dataSource.options||{}).itemCanUpdate||(()=>!0);return f.createElement("button",{className:"btn btn-minier btn-info",onClick:()=>this.executeEdit(e),disabled:!t(e)},f.createElement("i",{className:"fa fa-pencil"}))}deleteButton(e){if(!this.dataSource.canDelete)return;let t=(this.dataSource.options||{}).itemCanDelete||(()=>!0);return f.createElement("button",{className:"btn btn-minier btn-danger",disabled:!t(e),ref:t=>{t&&(t.getAttribute("button-on-click")||(t.setAttribute("button-on-click","true"),y.buttonOnClick(t,()=>this.executeDelete(e))))}},f.createElement("i",{className:"fa fa-trash"}))}executeEdit(e){d(this,r).show(e)}executeDelete(e){if(this.deleteConfirmText){let t=this.deleteConfirmText(e);return new Promise((n,i)=>{y.confirm({title:"请确认",message:t,confirm:()=>c(this,void 0,void 0,(function*(){return this.dataSource.delete(e).then(e=>n(e)).catch(e=>i(e))})),cancle:()=>c(this,void 0,void 0,(function*(){n({})}))})})}return this.dataSource.delete(e)}searchControl(){let e=this.dataSource,t=e.options?e.options.search:null;return t?f.createElement(f.Fragment,null,f.createElement("input",{type:"text",className:"form-control pull-left input-sm",placeholder:t.placeholder||"",style:{width:300}}),f.createElement("button",{className:"btn btn-primary btn-sm"},f.createElement("i",{className:"fa fa-search"}),f.createElement("span",null,"搜索"))):null}rightCommands(e){return[]}leftCommands(e){return[]}render(){var e;let t=(null===(e=this.state)||void 0===e?void 0:e.tableSize)||this.calcTableSize();if(this.headerFixed){let e=(this.columns||[]).filter(e=>e.visible);return f.createElement(f.Fragment,null,f.createElement("table",{className:"table table-striped table-bordered table-hover",style:{margin:0}},f.createElement("thead",null,f.createElement("tr",null,e.map((t,n)=>f.createElement("th",{key:n,ref:i=>{i&&t.itemStyle&&(i.style.width=t.itemStyle.width||"",null==d(this,a)&&n==e.length-1&&(i.style.width=`calc(${i.style.width} + ${this.ScrollBarWidth}px)`))}},t.headerText)),d(this,a)?f.createElement("th",{style:{width:this.CommandColumnWidth+this.ScrollBarWidth}},d(this,a).headerText):null))),f.createElement("div",{className:g.classNames.tableWrapper,style:{height:t.height+"px",width:t.width+"px"}},f.createElement("table",{ref:e=>u(this,i,e||d(this,i))})))}return f.createElement("table",{ref:e=>u(this,i,e||d(this,i))})}boundField(e){return m.boundField(e)}dateTimeField(e){return m.dateTimeField(e)}checkboxListField(e){return m.checkboxListField(e)}customDataField(e){return m.customDataField(e)}}t.DataListPage=w,i=new WeakMap,r=new WeakMap,a=new WeakMap},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BasePage=void 0;const l=a(n(0)),s=n(2);class o extends l.Component{constructor(e){super(e),this.backButtonVisiable=!1;let t=this.render;this.render=()=>{let e=this.renderToolbarLeft(),n=this.renderToolbarRight();return l.createElement(l.Fragment,null,l.createElement("div",{className:"tabbable"},this.title?l.createElement("h4",{className:"pull-left",style:{margin:"2px 0 0 0"}},this.title):null,l.createElement("ul",{className:"nav nav-tabs"},e.map((e,t)=>l.createElement("li",{key:t,className:"pull-left"},e)),l.createElement("li",{className:"pull-right"},l.createElement("button",{className:"btn btn-primary btn-sm",style:{display:this.backButtonVisiable?"":"none"},onClick:()=>this.props.app.back()},l.createElement("i",{className:"fa fa-reply"}),l.createElement("span",null,s.strings.back))),n.reverse().map((e,t)=>l.createElement("li",{key:t,className:"pull-right"},e)))),t?t.apply(this):null)}}renderToolbarLeft(){return[]}renderToolbarRight(){return[]}}t.BasePage=o},function(e,t){e.exports=i},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},l=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function l(e){try{o(i.next(e))}catch(e){a(e)}}function s(e){try{o(i.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}o((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createItemDialog=void 0;const s=a(n(0)),o=n(3),c=a(n(4)),u=n(11),d=n(5),h=n(2);t.createItemDialog=function(e,t,n,i){class r extends s.Component{constructor(e){super(e),this.state={},this.beforeSaves=[],this.inputControls=[],n=this.cloneElement(n)}cloneElement(e){if(null==e)return null;if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>this.cloneElement(e));let t,n=e.type;console.assert(null!=n);let i=this;if("function"==typeof n&&n.constructor==d.InputControl.constructor){let n=e.props.ref;t=Object.assign({},e.props,{ref(e){e&&(i.inputControls.push(e),n&&n.apply(this))}})}t=t||e.props;let r,a=this.cloneElement(e.props.children);return r=Array.isArray(a)?s.createElement(n,t,...a):s.createElement(n,t,a),r}onSaveButtonClick(){return l(this,void 0,void 0,(function*(){if(this.validator.clearErrors(),!this.validator.check())return Promise.reject("validate fail");yield this.save(),o.hideDialog(this.dialogElement)}))}setDataItem(n){this.dataItem=n;let i=(e.primaryKeys||[]).map(e=>n[e]).filter(e=>e).length>0?`${h.strings.modify}${t}`:`${h.strings.add}${t}`;this.inputControls.forEach(e=>{let t=n[e.props.dataField];e.value=t}),this.setState({title:i})}save(){return l(this,void 0,void 0,(function*(){let t=this.dataItem;this.inputControls.forEach(e=>{t[e.props.dataField]=e.value}),i&&(yield i(t)),this.beforeSaves.length>0&&(yield Promise.all(this.beforeSaves.map(e=>e(t)))),e.primaryKeys.map(e=>t[e]).filter(e=>null!=e).length>0?yield e.update(t):yield e.insert(t)}))}componentDidMount(){let e=this.inputControls.filter(e=>e.props.validation).map(e=>Object.assign({name:e.props.dataField},e.props.validation));this.validator=new u.FormValidator(this.fieldsConatiner,...e)}render(){let{title:e}=this.state;return s.createElement("div",{className:"modal-dialog"},s.createElement("div",{className:"modal-content"},s.createElement("div",{className:"modal-header"},s.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},s.createElement("span",{"aria-hidden":"true"},"×")),s.createElement("h4",{className:"modal-title"},e)),s.createElement("div",{className:"modal-body well",style:{paddingLeft:20,paddingRight:20},ref:e=>this.fieldsConatiner=e||this.fieldsConatiner},n),s.createElement("div",{className:"modal-footer"},s.createElement("button",{className:"btn btn-default",onClick:()=>{o.hideDialog(this.dialogElement)}},s.createElement("i",{className:"fa fa-reply"}),s.createElement("span",null,h.strings.cancel)),s.createElement("button",{className:"btn btn-primary",onClick:()=>this.onSaveButtonClick()},s.createElement("i",{className:"fa fa-save"}),s.createElement("span",null,h.strings.ok)))))}static show(e){if(e=e||{},!r.instance){let e=document.createElement("div");e.className="modal fade-in",document.body.appendChild(e),r.instance=c.render(s.createElement(r,null),e),r.instance.dialogElement=e}r.instance.validator&&r.instance.validator.clearErrors(),r.instance.setDataItem(e),o.showDialog(r.instance.dialogElement)}}return r}},function(e,t){e.exports=r}])}));
//# sourceMappingURL=index.min.js.map