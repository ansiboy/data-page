/*! maishu-data-page v1.3.4 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("maishu-ui-toolkit"),require("react-dom"),require("maishu-wuzhui-helper"),require("maishu-dilu"),require("maishu-toolkit")):"function"==typeof define&&define.amd?define(["react","maishu-ui-toolkit","react-dom","maishu-wuzhui-helper","maishu-dilu","maishu-toolkit"],t):"object"==typeof exports?exports["chitu-admin"]=t(require("react"),require("maishu-ui-toolkit"),require("react-dom"),require("maishu-wuzhui-helper"),require("maishu-dilu"),require("maishu-toolkit")):e["chitu-admin"]=t(e.react,e["maishu-ui-toolkit"],e["react-dom"],e["maishu-wuzhui-helper"],e["maishu-dilu"],e["maishu-toolkit"])}(window,(function(e,t,n,r,i,a){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.strings=void 0,t.strings={back:"返回",cancel:"取消",ok:"确定",modify:"修改",add:"添加",search:"搜索"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.classNames=void 0,t.classNames={tableWrapper:"table-wrapper"};if(!document.getElementById("maishu-data-page-style")&&null!=document.head){let e=document.createElement("style");e.type="text/css",e.id="maishu-data-page-style",document.head.appendChild(e),e.innerHTML=`\n.${t.classNames.tableWrapper} {\n    overflow-y: scroll;\n    overflow-x: hidden;\n    border: solid 1px #cccccc;\n    border-top: none;\n}\n.${t.classNames.tableWrapper} table tbody tr td:first-child {\n    border-left-color: white;\n}\n.${t.classNames.tableWrapper} table tbody tr td:last-child {\n    border-right-color: white;\n}\n.${t.classNames.tableWrapper} .table-bordered {\n    border: none;\n}\n`}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.InputControl=void 0;const l=a(n(0));class s extends l.Component{constructor(e){super(e)}}t.InputControl=s,s.defaultProps={validation:{rules:[]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataListPage=void 0,n(2);var r=n(7);Object.defineProperty(t,"DataListPage",{enumerable:!0,get:function(){return r.DataListPage}})},function(e,t,n){"use strict";var r,i,a,l,s,o,c,u,d,h=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),m=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),p=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&h(t,e,n);return m(t,e),t},f=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function l(e){try{o(r.next(e))}catch(e){a(e)}}function s(e){try{o(r.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}o((r=r.apply(e,t||[])).next())}))},b=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},v=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.DataListPage=void 0;const g=n(8),y=n(9),E=p(n(0)),w=n(10),C=p(n(4)),x=n(5),_=n(3),k=n(2),S=n(1),O=n(12);class j extends x.InputControl{constructor(e){super(e),this.state={}}get value(){return null!=this.control?this.control.value:this._value}set value(e){null!=this.control?this.control.value=e:this._value=e}render(){return console.assert(null!=this.state),E.createElement("span",{ref:e=>{null==this.control&&null!=e&&(this.control=this.props.boundField.createControl(),this.control.element.setAttribute("name",this.props.dataField),this.control.value=this._value,this.props.emptyText&&(this.control.element.placeholder=this.props.emptyText),this.control.element.onchange=()=>{this._value=this.control.value},e.appendChild(this.control.element))}})}}class P extends y.GridViewCell{constructor(e,t){super(e),this.changed=O.Callback.create(),r.set(this,void 0),this.dataItem=t,C.render(E.createElement("input",{type:"checkbox",style:{cursor:"pointer"},ref:e=>v(this,r,e||b(this,r)),onChange:e=>{this.changed.fire({sender:this})}}),e)}get checked(){return b(this,r).checked}set checked(e){e!=b(this,r).checked&&(b(this,r).checked=e,this.changed.fire({sender:this}))}}r=new WeakMap;class N extends y.DataControlField{constructor(e){super(e),this.itemSelected=O.Callback.create(),this.itemUnselected=O.Callback.create(),i.set(this,void 0),a.set(this,[]),l.set(this,void 0),v(this,i,e.dataSource),b(this,i).selected.add(()=>{v(this,a,[])})}get selectedItems(){return b(this,a).filter(e=>e.checked).map(e=>e.dataItem)}get cells(){return b(this,a)}createItemCell(e,t){let n=new P(t,e);return n.style(this.itemStyle),n.changed.add(t=>{t.sender.checked?this.itemSelected.fire({dataItem:e,selectedItems:this.selectedItems}):this.itemUnselected.fire({dataItem:e,selectedItems:this.selectedItems});let n=b(this,a).filter(e=>e.checked).length==b(this,a).length;b(this,l).checked=n}),b(this,a).push(n),b(this,l).checked=!1,n}createHeaderCell(e){let t=super.createHeaderCell(e);return C.render(E.createElement(E.Fragment,null,E.createElement("input",{type:"checkbox",style:{cursor:"pointer"},ref:e=>v(this,l,e||b(this,l)),onChange:e=>{let t=e.target.checked;b(this,a).forEach(e=>{e.checked=t})}})),e),t}}i=new WeakMap,a=new WeakMap,l=new WeakMap;class F extends g.BasePage{constructor(e){if(super(e),s.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u.set(this,void 0),d.set(this,void 0),this.CommandColumnWidth=140,this.ScrollBarWidth=18,this.pageSize=15,this.headerFixed=!1,null==this.dataSource)throw new Error("Data source is null.");if(this.showCommandColumn){let e=this;v(this,u,new y.CustomField({headerText:"操作",headerStyle:{textAlign:"center",width:this.commandColumnWidth+"px"},itemStyle:{textAlign:"center",width:this.commandColumnWidth+"px"},createItemCell(t,n){let r=new y.GridViewCell(n);return C.render(E.createElement(E.Fragment,null,e.leftCommands(t),e.editButton(t),e.deleteButton(t),e.rightCommands(t)),r.element),r}}))}this.showSelectItemColumn&&v(this,d,new N({headerStyle:{width:"40px"},itemStyle:{textAlign:"center"},dataSource:this.dataSource})),window.addEventListener("resize",()=>{if(null!=this.tableHeader){let e=this.calcTableSize();this.setState({tableSize:e})}})}get dialogTitles(){return{add:S.strings.add,edit:S.strings.modify}}get dataSource(){return null}get showCommandColumn(){return!0}get showSelectItemColumn(){return!1}get selectItemColumn(){return b(this,d)}get commandColumnWidth(){return this.CommandColumnWidth}get scrollBarWidth(){return this.ScrollBarWidth}calcTableSize(){console.assert(null!=this.tableHeader);let e=this.tableHeader.getBoundingClientRect(),t=window.innerHeight-160;return{width:e.width,height:t}}renderEditor(){return E.createElement(E.Fragment,null,this.columns.filter(e=>e instanceof y.BoundField&&1!=e.readOnly).map((e,t)=>E.createElement("div",{key:t,className:"form-group clearfix input-control"},E.createElement("label",null,e.headerText),E.createElement(j,{boundField:e,dataField:e.dataField,validation:e.validation,emptyText:e.emptyText}))))}toolbarRightCommands(){let e=this.renderEditor();if(null==e)return[];v(this,o,w.createItemDialog(this.dataSource,this.dialogTitles,e,"insert")),v(this,c,w.createItemDialog(this.dataSource,this.dialogTitles,e,"update"));let t=this.addButton(),n=this.searchControl(),r=[];return n&&r.push(n),t&&r.push(t),r}addButton(){return this.dataSource.canInsert?E.createElement("button",{key:"btnAdd",className:"btn btn-primary",onClick:()=>this.executeAdd()},E.createElement("i",{className:"fa fa-plus"}),E.createElement("span",null,S.strings.add)):null}editButton(e){if(!this.dataSource.canUpdate)return null;let t=(this.dataSource.options||{}).itemCanUpdate||(()=>!0);return E.createElement("button",{className:"btn btn-minier btn-info",onClick:()=>this.executeEdit(e),disabled:!t(e)},E.createElement("i",{className:"fa fa-pencil"}))}deleteButton(e){if(!this.dataSource.canDelete)return;let t=(this.dataSource.options||{}).itemCanDelete||(()=>!0);return E.createElement("button",{className:"btn btn-minier btn-danger",disabled:!t(e),ref:t=>{t&&(t.getAttribute("button-on-click")||(t.setAttribute("button-on-click","true"),_.buttonOnClick(t,()=>this.executeDelete(e))))}},E.createElement("i",{className:"fa fa-trash"}))}executeEdit(e){b(this,c).show(e)}executeDelete(e){if(this.deleteConfirmText){let t=this.deleteConfirmText(e);return new Promise((n,r)=>{_.confirm({title:"请确认",message:t,confirm:()=>f(this,void 0,void 0,(function*(){return this.dataSource.delete(e).then(e=>n(e)).catch(e=>r(e))})),cancle:()=>f(this,void 0,void 0,(function*(){n({})}))})})}return this.dataSource.delete(e)}executeAdd(){b(this,o).show({})}searchControl(){let e=this.dataSource,t=e.options?e.options.search:null;return t?E.createElement(E.Fragment,null,E.createElement("input",{type:"text",className:"form-control pull-left input-sm",placeholder:t.placeholder||"",style:{width:300}}),E.createElement("button",{className:"btn btn-primary"},E.createElement("i",{className:"fa fa-search"}),E.createElement("span",null,S.strings.search))):null}rightCommands(e){return this.itemRightCommands(e)}leftCommands(e){return this.itemLeftCommands(e)}itemRightCommands(e){return[]}itemLeftCommands(e){return[]}tableRef(e){if(null==e||null!=b(this,s))return;v(this,s,e||b(this,s));let t=[...this.columns||[]];b(this,d)&&t.unshift(b(this,d)),b(this,u)&&t.push(b(this,u)),this.gridView=y.createGridView({element:b(this,s),dataSource:this.dataSource,columns:t,pageSize:this.pageSize,translate:this.translate,showHeader:1!=this.headerFixed})}render(){var e;let t=null===(e=this.state)||void 0===e?void 0:e.tableSize;if(this.headerFixed){let e=(this.columns||[]).filter(e=>e.visible);return E.createElement(E.Fragment,null,E.createElement("table",{className:"table table-striped table-bordered table-hover",style:{margin:0},ref:e=>{e&&(this.tableHeader=e||this.tableHeader,null!=this.tableHeader&&null==t&&setTimeout(()=>{let e=this.calcTableSize();this.setState({tableSize:e})},300))}},E.createElement("thead",null,E.createElement("tr",null,e.map((t,n)=>E.createElement("th",{key:n,ref:r=>{r&&t.itemStyle&&(r.style.width=t.itemStyle.width||"",null==b(this,u)&&n==e.length-1&&(r.style.width=`calc(${r.style.width} + ${this.scrollBarWidth}px)`))}},t.headerText)),b(this,u)?E.createElement("th",{style:{width:this.commandColumnWidth+this.scrollBarWidth}},b(this,u).headerText):null))),E.createElement("div",{className:k.classNames.tableWrapper,style:t?{height:t.height+"px"}:{}},E.createElement("table",{ref:e=>this.tableRef(e)})))}return E.createElement("table",{ref:e=>this.tableRef(e)})}boundField(e){return y.boundField(e)}dateTimeField(e){return y.dateTimeField(e)}checkboxListField(e){return y.checkboxListField(e)}customDataField(e){return y.customDataField(e)}}t.DataListPage=F,s=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BasePage=void 0;const l=a(n(0)),s=n(1);class o extends l.Component{constructor(e){super(e),this.backButtonVisiable=!1;let t=this.render;this.render=()=>l.createElement(l.Fragment,null,this.renderToolbar(),t?t.apply(this):null)}renderToolbar(){let e=this.renderToolbarLeft(),t=this.renderToolbarRight();return l.createElement("div",{className:"tabbable"},this.title?l.createElement("h4",{className:"pull-left",style:{margin:"2px 0 0 0"}},this.title):null,l.createElement("ul",{className:"nav nav-tabs"},e.map((e,t)=>l.createElement("li",{key:t,className:"pull-left"},e)),l.createElement("li",{className:"pull-right"},l.createElement("button",{className:"btn btn-primary",style:{display:this.backButtonVisiable?"":"none"},onClick:()=>this.props.app.back()},l.createElement("i",{className:"fa fa-reply"}),l.createElement("span",null,s.strings.back))),t.reverse().map((e,t)=>l.createElement("li",{key:t,className:"pull-right"},e))))}renderToolbarLeft(){return this.toolbarLeftCommands()}renderToolbarRight(){return this.toolbarRightCommands()}toolbarLeftCommands(){return[]}toolbarRightCommands(){return[]}}t.BasePage=o},function(e,t){e.exports=r},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function l(e){try{o(r.next(e))}catch(e){a(e)}}function s(e){try{o(r.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}o((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createItemDialog=void 0;const s=a(n(0)),o=n(3),c=a(n(4)),u=n(11),d=n(5),h=n(1);t.createItemDialog=function(e,t,n,r,i){class a extends s.Component{constructor(e){super(e),this.state={},this.beforeSaves=[],this.inputControls=[],n=this.cloneElement(n)}cloneElement(e){if(null==e)return null;if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>this.cloneElement(e));let t,n=e.type;console.assert(null!=n);let r=this;if("function"==typeof n&&n.constructor==d.InputControl.constructor){let n=e.props.ref;t=Object.assign({},e.props,{ref(e){e&&(r.inputControls.push(e),n&&n.apply(this))}})}t=t||e.props;let i,a=this.cloneElement(e.props.children);return i=Array.isArray(a)?s.createElement(n,t,...a):s.createElement(n,t,a),i}onSaveButtonClick(){return l(this,void 0,void 0,(function*(){if(this.validator.clearErrors(),!this.validator.check())return Promise.reject("validate fail");yield this.save(),o.hideDialog(this.dialogElement)}))}setDataItem(n){this.dataItem=n;let r=(e.primaryKeys||[]).map(e=>n[e]).filter(e=>e).length>0?t.edit:t.add;this.inputControls.forEach(e=>{let t=n[e.props.dataField];e.value=t}),this.setState({title:r})}save(){return l(this,void 0,void 0,(function*(){let t=this.dataItem;this.inputControls.forEach(e=>{t[e.props.dataField]=e.value}),i&&(yield i(t)),this.beforeSaves.length>0&&(yield Promise.all(this.beforeSaves.map(e=>e(t))));e.primaryKeys.map(e=>t[e]).filter(e=>null!=e);if("update"==r)yield e.update(t);else{if("insert"!=r)throw new Error(`Unknown exec method ${r}.`);yield e.insert(t)}}))}componentDidMount(){let e=this.inputControls.filter(e=>e.props.validation).map(e=>Object.assign({name:e.props.dataField},e.props.validation));this.validator=new u.FormValidator(this.fieldsConatiner,...e)}render(){let{title:e}=this.state;return s.createElement("div",{className:"modal-dialog"},s.createElement("div",{className:"modal-content"},s.createElement("div",{className:"modal-header"},s.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},s.createElement("span",{"aria-hidden":"true"},"×")),s.createElement("h4",{className:"modal-title"},e)),s.createElement("div",{className:"modal-body well",style:{paddingLeft:20,paddingRight:20},ref:e=>this.fieldsConatiner=e||this.fieldsConatiner},n),s.createElement("div",{className:"modal-footer"},s.createElement("button",{className:"btn btn-default",onClick:()=>{o.hideDialog(this.dialogElement)}},s.createElement("i",{className:"fa fa-reply"}),s.createElement("span",null,h.strings.cancel)),s.createElement("button",{className:"btn btn-primary",onClick:()=>this.onSaveButtonClick()},s.createElement("i",{className:"fa fa-save"}),s.createElement("span",null,h.strings.ok)))))}static show(e){if(e=e||{},!a.instance){let e=document.createElement("div");e.className="modal fade-in",document.body.appendChild(e),a.instance=c.render(s.createElement(a,null),e),a.instance.dialogElement=e}a.instance.validator&&a.instance.validator.clearErrors(),a.instance.setDataItem(e),o.showDialog(a.instance.dialogElement)}}return a}},function(e,t){e.exports=i},function(e,t){e.exports=a}])}));
//# sourceMappingURL=index.min.js.map