!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("maishu-ui-toolkit"),require("react-dom"),require("maishu-wuzhui-helper"),require("maishu-dilu")):"function"==typeof define&&define.amd?define(["react","maishu-ui-toolkit","react-dom","maishu-wuzhui-helper","maishu-dilu"],t):"object"==typeof exports?exports["chitu-admin"]=t(require("react"),require("maishu-ui-toolkit"),require("react-dom"),require("maishu-wuzhui-helper"),require("maishu-dilu")):e["chitu-admin"]=t(e.react,e["maishu-ui-toolkit"],e["react-dom"],e["maishu-wuzhui-helper"],e["maishu-dilu"])}(window,(function(e,t,n,r,a){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.classNames=void 0,t.classNames={tableWrapper:"table-wrapper"};if(!document.getElementById("maishu-data-page-style")&&null!=document.head){let e=document.createElement("style");e.type="text/css",e.id="maishu-data-page-style",document.head.appendChild(e),e.innerHTML=`\n.${t.classNames.tableWrapper} {\n    overflow-y: scroll;\n    overflow-x: hidden;\n    border: solid 1px #cccccc;\n    border-top: none;\n}\n.${t.classNames.tableWrapper} table tbody tr td:first-child {\n    border-left-color: white;\n}\n.${t.classNames.tableWrapper} table tbody tr td:last-child {\n    border-right-color: white;\n}\n.${t.classNames.tableWrapper} .table-bordered {\n    border: none;\n}\n`}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.strings=void 0,t.strings={back:"返回",cancel:"取消",ok:"确定"}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.InputControl=void 0;const l=i(n(0));class o extends l.Component{constructor(e){super(e)}}t.InputControl=o,o.defaultProps={validateRules:[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataListPage=void 0,n(1);var r=n(7);Object.defineProperty(t,"DataListPage",{enumerable:!0,get:function(){return r.DataListPage}})},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t},l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function l(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,o)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DataListPage=void 0;const o=n(8),s=n(9),u=i(n(0)),c=n(10),d=i(n(4)),m=n(5),h=n(3),f=n(1);class p extends m.InputControl{constructor(e){super(e),this.state={}}get value(){return this._value}set value(e){this._value=e,null!=this.control&&(this.control.value=e)}render(){return console.assert(null!=this.state),u.createElement("span",{ref:e=>{null==this.control&&null!=e&&(this.control=this.props.boundField.createControl(),this.control.element.setAttribute("name",this.props.dataField),this.control.value=this._value,this.control.element.onchange=()=>{this._value=this.control.value},e.appendChild(this.control.element))}})}}class b extends o.BasePage{constructor(e){if(super(e),this.CommandColumnWidth=140,this.ScrollBarWidth=18,this.pageSize=15,this.headerFixed=!1,this.showCommandColumn=!0,this.showCommandColumn){let e=this;this.commandColumn=new s.CustomField({headerText:"操作",headerStyle:{textAlign:"center",width:`${this.CommandColumnWidth}px`},itemStyle:{textAlign:"center",width:`${this.CommandColumnWidth}px`},createItemCell(t,n){let r=new s.GridViewCell(n);return d.render(u.createElement(u.Fragment,null,e.leftCommands(t),e.editButton(t),e.deleteButton(t),e.rightCommands(t)),r.element),r}})}window.addEventListener("resize",()=>{let e,t=window.innerHeight-160,n=window.innerWidth-80,r=document.getElementsByClassName("first")[0],a=document.getElementsByClassName("second")[0];r&&(n-=r.offsetWidth),a&&(n-=a.offsetWidth),null!=this.state&&(e=this.state.tableSize),null!=e&&e.height==t&&e.width==n||this.setState({tableSize:{width:n,height:t}})})}calcTableSize(){let e=window.innerHeight-160,t=window.innerWidth-40,n=document.getElementsByClassName("first")[0],r=document.getElementsByClassName("second")[0];return n&&(t-=n.offsetWidth),r&&(t-=r.offsetWidth),{width:t,height:e}}componentDidMount(){this.columns=this.columns||[],s.createGridView({element:this.itemTable,dataSource:this.dataSource,columns:this.commandColumn?[...this.columns,this.commandColumn]:this.columns,pageSize:this.pageSize,translate:this.translate,showHeader:1!=this.headerFixed,showPagingBar:!1})}renderEditor(){return u.createElement(u.Fragment,null,this.columns.filter(e=>e instanceof s.BoundField&&1!=e.readOnly).map((e,t)=>u.createElement("div",{key:t,className:"form-group clearfix input-control"},u.createElement("label",null,e.headerText),u.createElement(p,{boundField:e,dataField:e.dataField,validateRules:e.validateRules}))))}renderToolbarRight(){let e=this.renderEditor();if(null==e)return[];this.dialog=c.createItemDialog(this.dataSource,this.itemName||"",e);let t=this.addButton(),n=this.searchControl(),r=[];return n&&r.push(n),t&&r.push(t),r}addButton(){return this.dataSource.canInsert?u.createElement("button",{key:"btnAdd",className:"btn btn-primary btn-sm",onClick:()=>this.dialog.show({})},u.createElement("i",{className:"fa fa-plus"}),u.createElement("span",null,"添加")):null}editButton(e){if(!this.dataSource.canUpdate)return null;let t=(this.dataSource.options||{}).itemCanUpdate||(()=>!0);return u.createElement("button",{className:"btn btn-minier btn-info",onClick:()=>this.executeEdit(e),disabled:!t(e)},u.createElement("i",{className:"fa fa-pencil"}))}deleteButton(e){if(!this.dataSource.canDelete)return;let t=(this.dataSource.options||{}).itemCanDelete||(()=>!0);return u.createElement("button",{className:"btn btn-minier btn-danger",disabled:!t(e),ref:t=>{t&&(t.getAttribute("button-on-click")||(t.setAttribute("button-on-click","true"),h.buttonOnClick(t,()=>this.executeDelete(e))))}},u.createElement("i",{className:"fa fa-trash"}))}executeEdit(e){this.dialog.show(e)}executeDelete(e){if(this.deleteConfirmText){let t=this.deleteConfirmText(e);return new Promise((n,r)=>{h.confirm({title:"请确认",message:t,confirm:()=>l(this,void 0,void 0,(function*(){return this.dataSource.delete(e).then(e=>n(e)).catch(e=>r(e))})),cancle:()=>l(this,void 0,void 0,(function*(){n({})}))})})}return this.dataSource.delete(e)}searchControl(){let e=this.dataSource,t=e.options?e.options.search:null;return t?u.createElement(u.Fragment,null,u.createElement("input",{type:"text",className:"form-control pull-left input-sm",placeholder:t.placeholder||"",style:{width:300}}),u.createElement("button",{className:"btn btn-primary btn-sm"},u.createElement("i",{className:"fa fa-search"}),u.createElement("span",null,"搜索"))):null}rightCommands(e){return[]}leftCommands(e){return[]}render(){var e;let t=(null===(e=this.state)||void 0===e?void 0:e.tableSize)||this.calcTableSize();if(this.headerFixed){let e=this.columns||[];return u.createElement(u.Fragment,null,u.createElement("table",{className:"table table-striped table-bordered table-hover",style:{margin:0}},u.createElement("thead",null,u.createElement("tr",null,e.map((t,n)=>u.createElement("th",{key:n,ref:r=>{r&&t.itemStyle&&(r.style.width=t.itemStyle.width||"",null==this.commandColumn&&n==e.length-1&&(r.style.width=`calc(${r.style.width} + ${this.ScrollBarWidth}px)`))}},t.headerText)),this.commandColumn?u.createElement("th",{style:{width:this.CommandColumnWidth+this.ScrollBarWidth}},this.commandColumn.headerText):null))),u.createElement("div",{className:f.classNames.tableWrapper,style:{height:`${t.height}px`,width:`${t.width}px`}},u.createElement("table",{ref:e=>this.itemTable=e||this.itemTable})))}return u.createElement("table",{ref:e=>this.itemTable=e||this.itemTable})}boundField(e){return s.boundField(e)}dateTimeField(e){return s.dateTimeField(e)}checkboxListField(e){return s.checkboxListField(e)}}t.DataListPage=b},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BasePage=void 0;const l=i(n(0)),o=n(2);class s extends l.Component{constructor(e){super(e),this.backButtonVisiable=!1;let t=this.render;this.render=()=>{let e=this.renderToolbarLeft(),n=this.renderToolbarRight();return l.createElement(l.Fragment,null,l.createElement("div",{className:"tabbable"},this.title?l.createElement("h4",{className:"pull-left",style:{margin:"2px 0 0 0"}},this.title):null,l.createElement("ul",{className:"nav nav-tabs"},e.map((e,t)=>l.createElement("li",{key:t,className:"pull-left"},e)),l.createElement("li",{className:"pull-right"},l.createElement("button",{className:"btn btn-primary btn-sm",style:{display:this.backButtonVisiable?"":"none"},onClick:()=>this.props.app.back()},l.createElement("i",{className:"fa fa-reply"}),l.createElement("span",null,o.strings.back))),n.reverse().map((e,t)=>l.createElement("li",{key:t,className:"pull-right"},e)))),t?t.apply(this):null)}}renderToolbarLeft(){return[]}renderToolbarRight(){return[]}}t.BasePage=s},function(e,t){e.exports=r},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t},l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function l(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,o)}s((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createItemDialog=void 0;const o=i(n(0)),s=n(3),u=i(n(4)),c=n(11),d=n(5),m=n(2);t.createItemDialog=function(e,t,n,r){class a extends o.Component{constructor(e){super(e),this.state={},this.beforeSaves=[],this.inputControls=[],n=this.cloneElement(n)}cloneElement(e){if(null==e)return null;if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>this.cloneElement(e));let t,n=e.type;console.assert(null!=n);let r=this;if("function"==typeof n&&n.constructor==d.InputControl.constructor){let n=e.props.ref;t=Object.assign({},e.props,{ref(e){e&&(r.inputControls.push(e),n&&n.apply(this))}})}t=t||e.props;let a,i=this.cloneElement(e.props.children);return a=Array.isArray(i)?o.createElement(n,t,...i):o.createElement(n,t,i),a}onSaveButtonClick(){return l(this,void 0,void 0,(function*(){if(this.validator.clearErrors(),!this.validator.check())return Promise.reject("validate fail");yield this.save(),s.hideDialog(this.dialogElement)}))}setDataItem(n){this.dataItem=n;let r=(e.primaryKeys||[]).map(e=>n[e]).filter(e=>e).length>0?`修改${t}`:`添加${t}`;this.inputControls.forEach(e=>{let t=n[e.props.dataField];e.value=t}),this.setState({title:r})}save(){return l(this,void 0,void 0,(function*(){let t=this.dataItem;this.inputControls.forEach(e=>{t[e.props.dataField]=e.value}),r&&(yield r(t)),this.beforeSaves.length>0&&(yield Promise.all(this.beforeSaves.map(e=>e(t)))),e.primaryKeys.map(e=>t[e]).filter(e=>null!=e).length>0?yield e.update(t):yield e.insert(t)}))}componentDidMount(){let e=this.inputControls.filter(e=>e.props.validateRules).map(e=>({name:e.props.dataField,rules:e.props.validateRules||[]}));this.validator=new c.FormValidator(this.fieldsConatiner,...e)}render(){let{title:e}=this.state;return o.createElement("div",{className:"modal-dialog"},o.createElement("div",{className:"modal-content"},o.createElement("div",{className:"modal-header"},o.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},o.createElement("span",{"aria-hidden":"true"},"×")),o.createElement("h4",{className:"modal-title"},e)),o.createElement("div",{className:"modal-body well",style:{paddingLeft:20,paddingRight:20},ref:e=>this.fieldsConatiner=e||this.fieldsConatiner},n),o.createElement("div",{className:"modal-footer"},o.createElement("button",{className:"btn btn-default",onClick:()=>{s.hideDialog(this.dialogElement)}},o.createElement("i",{className:"fa fa-reply"}),o.createElement("span",null,m.strings.cancel)),o.createElement("button",{className:"btn btn-primary",onClick:()=>this.onSaveButtonClick()},o.createElement("i",{className:"fa fa-save"}),o.createElement("span",null,m.strings.ok)))))}static show(e){if(e=e||{},!a.instance){let e=document.createElement("div");e.className="modal fade-in",document.body.appendChild(e),a.instance=u.render(o.createElement(a,null),e),a.instance.dialogElement=e}a.instance.validator&&a.instance.validator.clearErrors(),a.instance.setDataItem(e),s.showDialog(a.instance.dialogElement)}}return a}},function(e,t){e.exports=a}])}));
//# sourceMappingURL=index.min.js.map