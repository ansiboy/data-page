/*! maishu-data-page v1.3.0 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("maishu-ui-toolkit"),require("react-dom"),require("maishu-wuzhui-helper"),require("maishu-dilu"),require("maishu-toolkit")):"function"==typeof define&&define.amd?define(["react","maishu-ui-toolkit","react-dom","maishu-wuzhui-helper","maishu-dilu","maishu-toolkit"],t):"object"==typeof exports?exports["chitu-admin"]=t(require("react"),require("maishu-ui-toolkit"),require("react-dom"),require("maishu-wuzhui-helper"),require("maishu-dilu"),require("maishu-toolkit")):e["chitu-admin"]=t(e.react,e["maishu-ui-toolkit"],e["react-dom"],e["maishu-wuzhui-helper"],e["maishu-dilu"],e["maishu-toolkit"])}(window,(function(e,t,n,i,r,a){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.strings=void 0,t.strings={back:"返回",cancel:"取消",ok:"确定",modify:"修改",add:"添加",search:"搜索"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.classNames=void 0,t.classNames={tableWrapper:"table-wrapper"};if(!document.getElementById("maishu-data-page-style")&&null!=document.head){let e=document.createElement("style");e.type="text/css",e.id="maishu-data-page-style",document.head.appendChild(e),e.innerHTML=`\n.${t.classNames.tableWrapper} {\n    overflow-y: scroll;\n    overflow-x: hidden;\n    border: solid 1px #cccccc;\n    border-top: none;\n}\n.${t.classNames.tableWrapper} table tbody tr td:first-child {\n    border-left-color: white;\n}\n.${t.classNames.tableWrapper} table tbody tr td:last-child {\n    border-right-color: white;\n}\n.${t.classNames.tableWrapper} .table-bordered {\n    border: none;\n}\n`}},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.InputControl=void 0;const l=a(n(0));class s extends l.Component{constructor(e){super(e)}}t.InputControl=s,s.defaultProps={validation:{rules:[]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataListPage=void 0,n(2);var i=n(7);Object.defineProperty(t,"DataListPage",{enumerable:!0,get:function(){return i.DataListPage}})},function(e,t,n){"use strict";var i,r,a,l,s,o,c,u,d,h=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),m=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),f=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&h(t,e,n);return m(t,e),t},p=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function l(e){try{o(i.next(e))}catch(e){a(e)}}function s(e){try{o(i.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}o((i=i.apply(e,t||[])).next())}))},b=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},g=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.DataListPage=void 0;const v=n(8),y=n(9),w=f(n(0)),E=n(10),C=f(n(4)),_=n(5),x=n(3),k=n(2),S=n(1),N=n(12);class O extends _.InputControl{constructor(e){super(e),this.state={}}get value(){return null!=this.control?this.control.value:this._value}set value(e){null!=this.control?this.control.value=e:this._value=e}render(){return console.assert(null!=this.state),w.createElement("span",{ref:e=>{null==this.control&&null!=e&&(this.control=this.props.boundField.createControl(),this.control.element.setAttribute("name",this.props.dataField),this.control.value=this._value,this.props.emptyText&&(this.control.element.placeholder=this.props.emptyText),this.control.element.onchange=()=>{this._value=this.control.value},e.appendChild(this.control.element))}})}}class j extends y.GridViewCell{constructor(e,t){super(e),this.changed=N.Callback.create(),i.set(this,void 0),this.dataItem=t,C.render(w.createElement("input",{type:"checkbox",style:{cursor:"pointer"},ref:e=>g(this,i,e||b(this,i)),onChange:e=>{this.changed.fire({sender:this})}}),e)}get checked(){return b(this,i).checked}set checked(e){e!=b(this,i).checked&&(b(this,i).checked=e,this.changed.fire({sender:this}))}}i=new WeakMap;class P extends y.DataControlField{constructor(e){super(e),this.itemSelected=N.Callback.create(),this.itemUnselected=N.Callback.create(),r.set(this,void 0),a.set(this,[]),l.set(this,void 0),g(this,r,e.dataSource),b(this,r).selected.add(()=>{g(this,a,[])})}get selectedItems(){return b(this,a).filter(e=>e.checked).map(e=>e.dataItem)}get cells(){return b(this,a)}createItemCell(e,t){let n=new j(t,e);return n.style(this.itemStyle),n.changed.add(t=>{t.sender.checked?this.itemSelected.fire({dataItem:e,selectedItems:this.selectedItems}):this.itemUnselected.fire({dataItem:e,selectedItems:this.selectedItems});let n=b(this,a).filter(e=>e.checked).length==b(this,a).length;b(this,l).checked=n}),b(this,a).push(n),b(this,l).checked=!1,n}createHeaderCell(e){let t=super.createHeaderCell(e);return C.render(w.createElement(w.Fragment,null,w.createElement("input",{type:"checkbox",style:{cursor:"pointer"},ref:e=>g(this,l,e||b(this,l)),onChange:e=>{let t=e.target.checked;b(this,a).forEach(e=>{e.checked=t})}})),e),t}}r=new WeakMap,a=new WeakMap,l=new WeakMap;class W extends v.BasePage{constructor(e){if(super(e),s.set(this,void 0),o.set(this,void 0),c.set(this,void 0),u.set(this,void 0),d.set(this,void 0),this.CommandColumnWidth=140,this.ScrollBarWidth=18,this.pageSize=15,this.headerFixed=!1,null==this.dataSource)throw new Error("Data source is null.");if(this.showCommandColumn){let e=this;g(this,u,new y.CustomField({headerText:"操作",headerStyle:{textAlign:"center",width:this.commandColumnWidth+"px"},itemStyle:{textAlign:"center",width:this.commandColumnWidth+"px"},createItemCell(t,n){let i=new y.GridViewCell(n);return C.render(w.createElement(w.Fragment,null,e.leftCommands(t),e.editButton(t),e.deleteButton(t),e.rightCommands(t)),i.element),i}}))}this.showSelectItemColumn&&g(this,d,new P({headerStyle:{width:"40px"},itemStyle:{textAlign:"center"},dataSource:this.dataSource})),window.addEventListener("resize",()=>{let e,t=window.innerHeight-160,n=window.innerWidth-80,i=document.getElementsByClassName("first")[0],r=document.getElementsByClassName("second")[0];i&&(n-=i.offsetWidth),r&&(n-=r.offsetWidth),null!=this.state&&(e=this.state.tableSize),null!=e&&e.height==t&&e.width==n||this.setState({tableSize:{width:n,height:t}})})}get dialogTitles(){return{add:S.strings.add,edit:S.strings.modify}}get dataSource(){return null}get showCommandColumn(){return!0}get showSelectItemColumn(){return!1}get selectItemColumn(){return b(this,d)}get commandColumnWidth(){return this.CommandColumnWidth}get scrollBarWidth(){return this.ScrollBarWidth}calcTableSize(){let e=window.innerHeight-160,t=window.innerWidth-40,n=document.getElementsByClassName("first")[0],i=document.getElementsByClassName("second")[0];return n&&(t-=n.offsetWidth),i&&(t-=i.offsetWidth),{width:t,height:e}}renderEditor(){return w.createElement(w.Fragment,null,this.columns.filter(e=>e instanceof y.BoundField&&1!=e.readOnly).map((e,t)=>w.createElement("div",{key:t,className:"form-group clearfix input-control"},w.createElement("label",null,e.headerText),w.createElement(O,{boundField:e,dataField:e.dataField,validation:e.validation,emptyText:e.emptyText}))))}toolbarRightCommands(){let e=this.renderEditor();if(null==e)return[];g(this,o,E.createItemDialog(this.dataSource,this.dialogTitles,e,"insert")),g(this,c,E.createItemDialog(this.dataSource,this.dialogTitles,e,"update"));let t=this.addButton(),n=this.searchControl(),i=[];return n&&i.push(n),t&&i.push(t),i}addButton(){return this.dataSource.canInsert?w.createElement("button",{key:"btnAdd",className:"btn btn-primary",onClick:()=>b(this,o).show({})},w.createElement("i",{className:"fa fa-plus"}),w.createElement("span",null,S.strings.add)):null}editButton(e){if(!this.dataSource.canUpdate)return null;let t=(this.dataSource.options||{}).itemCanUpdate||(()=>!0);return w.createElement("button",{className:"btn btn-minier btn-info",onClick:()=>this.executeEdit(e),disabled:!t(e)},w.createElement("i",{className:"fa fa-pencil"}))}deleteButton(e){if(!this.dataSource.canDelete)return;let t=(this.dataSource.options||{}).itemCanDelete||(()=>!0);return w.createElement("button",{className:"btn btn-minier btn-danger",disabled:!t(e),ref:t=>{t&&(t.getAttribute("button-on-click")||(t.setAttribute("button-on-click","true"),x.buttonOnClick(t,()=>this.executeDelete(e))))}},w.createElement("i",{className:"fa fa-trash"}))}executeEdit(e){b(this,c).show(e)}executeDelete(e){if(this.deleteConfirmText){let t=this.deleteConfirmText(e);return new Promise((n,i)=>{x.confirm({title:"请确认",message:t,confirm:()=>p(this,void 0,void 0,(function*(){return this.dataSource.delete(e).then(e=>n(e)).catch(e=>i(e))})),cancle:()=>p(this,void 0,void 0,(function*(){n({})}))})})}return this.dataSource.delete(e)}searchControl(){let e=this.dataSource,t=e.options?e.options.search:null;return t?w.createElement(w.Fragment,null,w.createElement("input",{type:"text",className:"form-control pull-left input-sm",placeholder:t.placeholder||"",style:{width:300}}),w.createElement("button",{className:"btn btn-primary"},w.createElement("i",{className:"fa fa-search"}),w.createElement("span",null,S.strings.search))):null}rightCommands(e){return this.itemRightCommands(e)}leftCommands(e){return this.itemLeftCommands(e)}itemRightCommands(e){return[]}itemLeftCommands(e){return[]}tableRef(e){if(null==e||null!=b(this,s))return;g(this,s,e||b(this,s));let t=[...this.columns||[]];b(this,d)&&t.unshift(b(this,d)),b(this,u)&&t.push(b(this,u)),this.gridView=y.createGridView({element:b(this,s),dataSource:this.dataSource,columns:t,pageSize:this.pageSize,translate:this.translate,showHeader:1!=this.headerFixed})}render(){var e;let t=(null===(e=this.state)||void 0===e?void 0:e.tableSize)||this.calcTableSize();if(this.headerFixed){let e=(this.columns||[]).filter(e=>e.visible);return w.createElement(w.Fragment,null,w.createElement("table",{className:"table table-striped table-bordered table-hover",style:{margin:0}},w.createElement("thead",null,w.createElement("tr",null,e.map((t,n)=>w.createElement("th",{key:n,ref:i=>{i&&t.itemStyle&&(i.style.width=t.itemStyle.width||"",null==b(this,u)&&n==e.length-1&&(i.style.width=`calc(${i.style.width} + ${this.scrollBarWidth}px)`))}},t.headerText)),b(this,u)?w.createElement("th",{style:{width:this.commandColumnWidth+this.scrollBarWidth}},b(this,u).headerText):null))),w.createElement("div",{className:k.classNames.tableWrapper,style:{height:t.height+"px",width:t.width+"px"}},w.createElement("table",{ref:e=>this.tableRef(e)})))}return w.createElement("table",{ref:e=>this.tableRef(e)})}boundField(e){return y.boundField(e)}dateTimeField(e){return y.dateTimeField(e)}checkboxListField(e){return y.checkboxListField(e)}customDataField(e){return y.customDataField(e)}}t.DataListPage=W,s=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BasePage=void 0;const l=a(n(0)),s=n(1);class o extends l.Component{constructor(e){super(e),this.backButtonVisiable=!1;let t=this.render;this.render=()=>l.createElement(l.Fragment,null,this.renderToolbar(),t?t.apply(this):null)}renderToolbar(){let e=this.renderToolbarLeft(),t=this.renderToolbarRight();return l.createElement("div",{className:"tabbable"},this.title?l.createElement("h4",{className:"pull-left",style:{margin:"2px 0 0 0"}},this.title):null,l.createElement("ul",{className:"nav nav-tabs"},e.map((e,t)=>l.createElement("li",{key:t,className:"pull-left"},e)),l.createElement("li",{className:"pull-right"},l.createElement("button",{className:"btn btn-primary",style:{display:this.backButtonVisiable?"":"none"},onClick:()=>this.props.app.back()},l.createElement("i",{className:"fa fa-reply"}),l.createElement("span",null,s.strings.back))),t.reverse().map((e,t)=>l.createElement("li",{key:t,className:"pull-right"},e))))}renderToolbarLeft(){return this.toolbarLeftCommands()}renderToolbarRight(){return this.toolbarRightCommands()}toolbarLeftCommands(){return[]}toolbarRightCommands(){return[]}}t.BasePage=o},function(e,t){e.exports=i},function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},l=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function l(e){try{o(i.next(e))}catch(e){a(e)}}function s(e){try{o(i.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}o((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createItemDialog=void 0;const s=a(n(0)),o=n(3),c=a(n(4)),u=n(11),d=n(5),h=n(1);t.createItemDialog=function(e,t,n,i,r){class a extends s.Component{constructor(e){super(e),this.state={},this.beforeSaves=[],this.inputControls=[],n=this.cloneElement(n)}cloneElement(e){if(null==e)return null;if("string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>this.cloneElement(e));let t,n=e.type;console.assert(null!=n);let i=this;if("function"==typeof n&&n.constructor==d.InputControl.constructor){let n=e.props.ref;t=Object.assign({},e.props,{ref(e){e&&(i.inputControls.push(e),n&&n.apply(this))}})}t=t||e.props;let r,a=this.cloneElement(e.props.children);return r=Array.isArray(a)?s.createElement(n,t,...a):s.createElement(n,t,a),r}onSaveButtonClick(){return l(this,void 0,void 0,(function*(){if(this.validator.clearErrors(),!this.validator.check())return Promise.reject("validate fail");yield this.save(),o.hideDialog(this.dialogElement)}))}setDataItem(n){this.dataItem=n;let i=(e.primaryKeys||[]).map(e=>n[e]).filter(e=>e).length>0?t.edit:t.add;this.inputControls.forEach(e=>{let t=n[e.props.dataField];e.value=t}),this.setState({title:i})}save(){return l(this,void 0,void 0,(function*(){let t=this.dataItem;this.inputControls.forEach(e=>{t[e.props.dataField]=e.value}),r&&(yield r(t)),this.beforeSaves.length>0&&(yield Promise.all(this.beforeSaves.map(e=>e(t))));e.primaryKeys.map(e=>t[e]).filter(e=>null!=e);if("update"==i)yield e.update(t);else{if("insert"!=i)throw new Error(`Unknown exec method ${i}.`);yield e.insert(t)}}))}componentDidMount(){let e=this.inputControls.filter(e=>e.props.validation).map(e=>Object.assign({name:e.props.dataField},e.props.validation));this.validator=new u.FormValidator(this.fieldsConatiner,...e)}render(){let{title:e}=this.state;return s.createElement("div",{className:"modal-dialog"},s.createElement("div",{className:"modal-content"},s.createElement("div",{className:"modal-header"},s.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},s.createElement("span",{"aria-hidden":"true"},"×")),s.createElement("h4",{className:"modal-title"},e)),s.createElement("div",{className:"modal-body well",style:{paddingLeft:20,paddingRight:20},ref:e=>this.fieldsConatiner=e||this.fieldsConatiner},n),s.createElement("div",{className:"modal-footer"},s.createElement("button",{className:"btn btn-default",onClick:()=>{o.hideDialog(this.dialogElement)}},s.createElement("i",{className:"fa fa-reply"}),s.createElement("span",null,h.strings.cancel)),s.createElement("button",{className:"btn btn-primary",onClick:()=>this.onSaveButtonClick()},s.createElement("i",{className:"fa fa-save"}),s.createElement("span",null,h.strings.ok)))))}static show(e){if(e=e||{},!a.instance){let e=document.createElement("div");e.className="modal fade-in",document.body.appendChild(e),a.instance=c.render(s.createElement(a,null),e),a.instance.dialogElement=e}a.instance.validator&&a.instance.validator.clearErrors(),a.instance.setDataItem(e),o.showDialog(a.instance.dialogElement)}}return a}},function(e,t){e.exports=r},function(e,t){e.exports=a}])}));
//# sourceMappingURL=index.min.js.map